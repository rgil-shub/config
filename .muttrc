# ~/.muttrc
#
# Version: 20170123 (mutt 1.7.2)
#
# References:
# -> http://www.elho.net/mutt/maildir
# -> https://wiki.debian.org/Mutt
# -> https://dev.mutt.org/trac/wiki/MuttGuide
#
# Requires:
# + vim
# + w3m
# + spamassassin

# set language
set charset="utf-8"
set locale="es_ES.utf-8"

# set from to ensure mutt doesn't put user@localhost.localhost 
set from="user@example.org"
set use_from=yes
set envelope_from="yes"

# set realname
set realname="username"

# set signature
set signature="~/.mutt/signature"

# GnuPG
# https://dev.mutt.org/trac/wiki/MuttGuide/UseGPG
source ~/.mutt/gpg.rc
# set pgp_use_gpg_agent = yes
set pgp_sign_as = your_key_id 
set pgp_timeout = 3600
set crypt_autosign = yes
set crypt_replyencrypt = yes

# HTML  (Requires: .mailcap + links/w3m)
set mailcap_path="~/.mutt/mailcap"
auto_view text/html

# set index format
set date_format="%Y-%m-%d %T"
set index_format="%2C | %Z [%d] %-30.30F (%-4.4c) %s"

# mutt version
push <show-version>

### LOCAL ###

# First tell Mutt to use the Maildir format:
set mbox_type=Maildir

# Next configure the locations of the common folders:
set folder="~/Maildir"
set mask="!^\\.[^.]"
set mbox="~/Maildir"
set record="+.Enviados"
set postponed="+.Borradores"
set spoolfile="~/Maildir"

# Set up mailboxes by scanning for all subfolders in ~/Maildir:
# mailboxes `echo -n "+ "; find ~/Maildir -maxdepth 1 -name ".*" -printf "+'%f' "`
# Note that this requires find(1) from the GNU findutils, which on BSD systems usually is installed as gfind(1).
mailboxes ! + `\
for file in ~/Maildir/.*; do \
    box=$(basename "$file"); \
    if [ ! "$box" = '.' -a ! "$box" = '..' -a ! "$box" = '.customflags' \
        -a ! "$box" = '.subscriptions' ]; then \
        echo -n "\"+$box\" "; \
    fi; \
done`

# Add macros to make the folder browser usable by always using the mailboxes setup above:
macro index c "<change-folder>?<toggle-mailboxes>" "open a different folder"
macro pager c "<change-folder>?<toggle-mailboxes>" "open a different folder"

# To additionally get straight to the folder browser when copying, moving and attaching mail, add the following macros:
macro index C "<copy-message>?<toggle-mailboxes>" "copy a message to a mailbox"
macro index M "<save-message>?<toggle-mailboxes>" "move a message to a mailbox"
macro compose A "<attach-message>?<toggle-mailboxes>" "attach message(s) to this message"

# Save the message to your archive folder:
macro index A  "<save-message>=.Archivos<enter>"  "mark message as Archived"
macro pager A  "<save-message>=.Archivos<enter>"  "mark message as Archived"

# Train spamassassin and move message to spam folder
macro index S "<enter-command>unset wait_key<enter><pipe-entry>sa-learn --spam<enter><enter-command>set wait_key<enter><save-message>=.Spam<enter>" "mark message as SPAM"

### IMAP ###

# Cache (Mutt > 1.5.7 & 1.5.12) 
# http://dev.mutt.org/trac/wiki/MuttGuide/Caching
set header_cache = "~/.mutt/headers"
set message_cachedir = "~/.mutt/messages"

# Display download progress every 5K
set net_inc=5

### OTHER OPTIONS ###

# Stops pager viewing next message
set pager_stop

# Set default editor
set editor="vim -c 'set spell spelllang=es,en'"

# Sort messages by thread
set sort=threads
set sort_aux = reverse-date-received

# Collapse old messages
set collapse_unread=no
folder-hook . 'push <collapse-all>'

# Alias
set alias_file= ~/.mutt/aliases
set sort_alias= alias
set reverse_alias=yes
source $alias_file

# Forwarding messages with attachments
set mime_forward
set mime_forward_rest=yes

# Headers
ignore *
unignore from subject to cc date x-mailer x-url user-agent x-operating-system x-pgp-key X-TLS-Protocol X-TLS-Cipher
unhdr_order *
hdr_order subject from to cc date X-TLS-Protocol X-TLS-Cipher
my_hdr X-Operating-System: `uname -s` `uname -r`
# my_hdr X-PGP-Key: http://example.org/~user/pubkey.asc

### COLOR DEFINITIONS ###

# for i in {0..255} ; do printf "\x1b[38;5;${i}mcolour${i}\n" ; done | column

# basic colors
color normal white default
color error brightred default
color tilde magenta default
color message white default
color markers brightcyan default
color attachment brightcyan default
color search brightwhite green
color status brightyellow black
color indicator white color241
color tree blue default

# index
color index brightwhite default "~O" # new messages
color index brightwhite default "~N" # new messages
color index brightred default "~D"   # deleted messages

# headers
color hdrdefault white default
color header brightyellow default ^Subject:
color header brightwhite default ^From:
color header color241 default  ^User-Agent:
color header color241 default  ^X-Mailer:
color header color241 default  ^X-Operating-System:
color header color241 default  ^X-PGP-Key:
color header green  default   "^(X-Tls-Protocol: TLSv1.3)"
color header color241 default  "^(X-Tls-Protocol: TLSv1.2)"
color header red default      "^(X-Tls-Protocol: TLSv1.1)"
color header red default      "^(X-Tls-Protocol: TLSv1.0)"
color header red default      "^(X-Tls-Protocol: NONE)"
color header red default      "^(X-Tls-Cipher: NONE)"
color header color241 default  "^(X-Tls-Cipher)"

# body
color quoted blue default
color signature color241 default
color body magenta default "(ftp|http|https)://[^ ]+"  # point out URLs
color body magenta default [-a-z_0-9.]+@[-a-z_0-9.]+   # e-mail addresses
color underline brightgreen default

# pgp
color body brightyellow default "^gpg: .*"
color body brightyellow default "^Hash: .*"
color body brightred default "^gpg: Firma INCORRECTA.*"
color body brightred default "^gpg: BAD signature.*"
color body brightgreen default "^gpg: Firma correcta.*"
color body brightgreen default "^gpg: Good signature .*"
color body brightcyan default "-----BEGIN PGP SIGNED MESSAGE-----"
color body brightcyan default "-----BEGIN PGP SIGNATURE-----"
color body brightcyan default "-----END PGP SIGNATURE-----"
